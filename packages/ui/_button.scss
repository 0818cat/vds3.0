@use "sass:map";
@use "sass:list";
@import "../core/vds3.0";

// --- 버튼 아키텍처 설정 (Advanced DS Configuration) ---
$btn-configs: (
    primary: (filled: (bg: var(--refine-accent), text: var(--static-white), overlay: (var(--interaction-surface), 'normal')),
        tonal: (bg: var(--colors-blue-25), text: var(--static-primary), overlay: (var(--static-primary), 'light')),
        outlined: (bg: transparent, text: var(--static-primary), border: var(--static-primary), overlay: (var(--static-primary), 'light')),
        ghost: (bg: transparent, text: var(--static-primary), overlay: (var(--static-primary), 'light'))),
    secondary: (filled: (bg: var(--refine-senary), text: var(--label-primary), overlay: (var(--interaction-surface), 'light')),
        outlined: (bg: transparent, text: var(--label-primary), border: var(--line-secondary), overlay: (var(--label-primary), 'light')),
        ghost: (bg: transparent, text: var(--label-primary), overlay: (var(--label-primary), 'light'))),
    tertiary: (filled: (bg: var(--refine-primary), text: var(--static-white), overlay: (var(--interaction-surface), 'normal')),
        ghost: (bg: transparent, text: var(--label-primary), overlay: (var(--label-primary), 'light'))),
    negative: (filled: (bg: var(--status-negative), text: var(--static-white), overlay: (var(--interaction-surface), 'normal')),
        tonal: (bg: var(--colors-red-25), text: var(--status-negative), overlay: (var(--status-negative), 'light')),
        outlined: (bg: transparent, text: var(--status-negative), border: var(--status-negative), overlay: (var(--status-negative), 'light')),
        ghost: (bg: transparent, text: var(--status-negative), overlay: (var(--status-negative), 'light')))
);



// --- 기본 버튼 스타일 ---
@mixin btn-base {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    // 성능 최적화: 필요한 속성만 transition 적용
    transition:
        background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1),
        color 0.2s cubic-bezier(0.4, 0, 0.2, 1),
        box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1),
        border-color 0.2s cubic-bezier(0.4, 0, 0.2, 1),
        opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
    outline: none;
    box-sizing: border-box;
    white-space: nowrap;
    user-select: none;
    font-family: var(--font-family-base);

    position: relative;
    overflow: hidden;
    @include interaction-overlay(var(--interaction-surface), 'light');
}

// --- 비활성화 스타일 Mixin (Specificity 기반) ---
@mixin btn-disabled($bg: transparent, $border: none) {
    cursor: not-allowed;
    pointer-events: none;
    opacity: 1;
    background-color: $bg;
    color: var(--label-quinary);
    border: $border;
    box-shadow: none;

    &::before,
    &::after {
        display: none;
    }
}

.btn {
    @include btn-base;

    // --- 크기 ---
    &--large {
        height: 48px;
        padding: 0 18px;
        border-radius: $radius-medium;
        gap: 6px;
        min-width: 84px;
        @include label-15-sb();

        .btn__leading-icon,
        .btn__trailing-icon {
            width: 18px;
            height: 18px;
        }
    }

    &--medium {
        height: 40px;
        padding: 0 14px;
        border-radius: $radius-medium;
        gap: 6px;
        min-width: 70px;
        @include label-14-sb();

        .btn__leading-icon,
        .btn__trailing-icon {
            width: 17px;
            height: 17px;
        }
    }

    &--small {
        height: 32px;
        padding: 0 10px;
        border-radius: $radius-small;
        gap: 4px;
        min-width: 56px;
        @include label-13-sb();

        .btn__leading-icon,
        .btn__trailing-icon {
            width: 16px;
            height: 16px;
        }
    }

    // --- 타입 & 색상 (Declarative Generation) ---
    @each $variant, $styles in $btn-configs {
        &--#{$variant} {
            $filled: map.get($styles, filled);

            // 1. 기본 스타일 (Filled)
            background-color: map.get($filled, bg);
            color: map.get($filled, text);

            $overlay: map.get($filled, overlay);
            @include interaction-overlay(list.nth($overlay, 1), list.nth($overlay, 2));

            @if $variant ==primary {
                @include elevation-20();
            }

            // 2. 다른 타입들 (Tonal, Outlined, Ghost)
            @each $type in (tonal, outlined, ghost) {
                $config: map.get($styles, $type);

                @if $config {
                    &.btn--#{$type} {
                        background-color: map.get($config, bg);
                        color: map.get($config, text);
                        box-shadow: none;

                        @if map.has-key($config, border) {
                            border: 1px solid map.get($config, border);
                        }

                        @else {
                            border: 1px solid transparent; // Specifcity 유지를 위해 투명 테두리 유지 가능
                            border: none;
                        }

                        $t-overlay: map.get($config, overlay);
                        @include interaction-overlay(list.nth($t-overlay, 1), list.nth($t-overlay, 2));
                    }
                }
            }

            // 3. 변형별 상태 관리 (Specificity Optimized)
            // .btn.btn--primary:disabled 형태로 선택자를 강화하여 !important 제거
            &.btn:disabled,
            &.btn.btn--disabled {
                @include btn-disabled(var(--interaction-disabled));

                @each $type in (tonal, outlined, ghost) {
                    $config: map.get($styles, $type);

                    @if $config {
                        &.btn--#{$type} {
                            @if $type ==outlined {
                                @include btn-disabled(transparent, 1px solid var(--interaction-disabled));
                            }

                            @else {
                                @include btn-disabled(transparent, none);
                            }
                        }
                    }
                }
            }
        }
    }

    // --- 로딩 ---
    &--loading,
    &[aria-busy="true"] {
        &.btn {
            cursor: wait;
            pointer-events: none;
            position: relative;
            color: transparent;
            box-shadow: none;

            &::before,
            &::after {
                display: none; // 로딩 중 인터랙션 방지
            }
        }

        // 로딩 애니메이션 컨테이너
        .btn__loading-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 18px;
            height: 18px;
            z-index: 1;
        }

        // 사이즈별 로딩 애니메이션 크기 조정
        &.btn--medium .btn__loading-animation {
            width: 17px;
            height: 17px;
        }

        &.btn--small .btn__loading-animation {
            width: 16px;
            height: 16px;
        }
    }

    // --- 아이콘 ---
    &__leading-icon,
    &__trailing-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;

        svg,
        img {
            width: 100%;
            height: 100%;
            display: block;
            fill: currentColor;
        }
    }
}

@keyframes btn-spin {
    to {
        transform: rotate(360deg);
    }
}
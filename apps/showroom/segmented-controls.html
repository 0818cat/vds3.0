<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDS 3.0 Component Gallery - SegmentedControl</title>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="showroom.css">
    <style>
        .preview-wrapper {
            display: flex;
            flex-direction: column;
            gap: 40px;
            width: 100%;
        }

        .preview-case {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .preview-label {
            font-size: 12px;
            font-weight: 400;
            color: var(--label-quaternary);
            text-transform: uppercase;
        }

        /* í”Œë ˆì´ê·¸ë¼ìš´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ */
        .preview-area {
            transition: background-color 0.2s ease;
            position: relative;
        }

        .preview-area.bg-surface {
            background-color: var(--fill-surface-primary);
        }

        .preview-area.bg-grey {
            background-color: var(--refine-senary);
        }

        .label-input-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        .label-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .label-input {
            flex: 2;
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid var(--line-secondary);
            background: var(--fill-surface-primary);
            color: var(--label-primary);
            font-size: 13px;
        }

        .number-input {
            flex: 1;
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid var(--line-secondary);
            background: var(--fill-surface-primary);
            color: var(--label-primary);
            font-size: 13px;
            width: 50px;
        }

        .label-input:focus,
        .number-input:focus {
            outline: none;
            border-color: var(--line-accent);
        }

        .item-count-control {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .count-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: 1px solid var(--line-secondary);
            background: var(--fill-surface-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--label-primary);
        }

        .count-btn:hover {
            background: var(--refine-senary);
        }
    </style>
</head>

<body>
    <header class="showroom-header">
        <div class="header-left">
            <span class="logo">VDS 3.0 Gallery</span>
        </div>
        <div class="header-right">
            <button id="theme-toggle" class="btn-theme-toggle" title="í…Œë§ˆ ì „í™˜">ğŸŒ“</button>
        </div>
    </header>

    <div class="app-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <div class="sidebar-title">Components</div>
                <ul class="sidebar-menu">
                    <li><a href="buttons.html" class="sidebar-link">Buttons</a></li>
                    <li><a href="icon-buttons.html" class="sidebar-link">Icon Buttons</a></li>
                    <li><a href="input-fields.html" class="sidebar-link">Input Fields</a></li>
                    <li><a href="dropdowns.html" class="sidebar-link">Dropdowns</a></li>
                    <li><a href="menus.html" class="sidebar-link">Menus</a></li>
                    <li><a href="tabs.html" class="sidebar-link">Tabs</a></li>
                    <li><a href="segmented-controls.html" class="sidebar-link active">SegmentedControl</a></li>
                </ul>
            </nav>
        </aside>

        <main class="showroom-main">
            <section class="component-section">
                <h1 class="section-title">SegmentedControl</h1>
                <p class="section-desc">ì—¬ëŸ¬ ì˜µì…˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. íƒ­ë³´ë‹¤ ì»´íŒ©íŠ¸í•˜ë©° ë²„íŠ¼ ê·¸ë£¹ í˜•íƒœì˜ UIë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
            </section>

            <section class="component-section">
                <h2 class="section-title">Interactive Playground</h2>
                <div class="playground-container">
                    <div class="preview-area" id="playground-preview">
                        <div id="playground-target">
                            <!-- JSì— ì˜í•´ ë Œë”ë§ë¨ -->
                        </div>
                    </div>
                    <div class="controls-area">
                        <div class="control-group">
                            <label class="control-label">Size</label>
                            <div class="toggle-group" id="size-toggles">
                                <button class="toggle-btn active" data-value="segmented-control--medium">Medium</button>
                                <button class="toggle-btn" data-value="segmented-control--small">Small</button>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Preview Background</label>
                            <div class="toggle-group" id="bg-toggles">
                                <button class="toggle-btn active" data-value="bg-surface">Surface</button>
                                <button class="toggle-btn" data-value="bg-grey">Grey (Contrast)</button>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Items Configuration (Label / Number)</label>
                            <div class="item-count-control">
                                <button class="count-btn" id="decrease-items">âˆ’</button>
                                <span id="current-count"
                                    style="min-width: 20px; text-align: center; font-weight: 600;">3</span>
                                <button class="count-btn" id="increase-items">+</button>
                            </div>
                            <div id="label-inputs" class="label-input-container">
                                <!-- JSì— ì˜í•´ ì…ë ¥ í•„ë“œ ìƒì„± -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="code-viewer">
                    <pre><code id="generated-code"></code></pre>
                    <button class="copy-btn" id="copy-code">ğŸ“‹</button>
                </div>
            </section>

            <section class="component-section">
                <h2 class="section-title">Gallery</h2>
                <div class="preview-wrapper">
                    <div class="preview-case">
                        <span class="preview-label">Medium with Sliding Animation</span>
                        <div class="segmented-control segmented-control--medium" id="gallery-sc-medium">
                            <div class="segmented-control__indicator"></div>
                            <div class="segmented-control__item segmented-control__item--active">Label <span
                                    class="segmented-control__number">12</span></div>
                            <div class="segmented-control__item">Label <span class="segmented-control__number">5</span>
                            </div>
                            <div class="segmented-control__item">Label</div>
                        </div>
                    </div>
                    <div class="preview-case">
                        <span class="preview-label">Small with Sliding Animation</span>
                        <div class="segmented-control segmented-control--small" id="gallery-sc-small">
                            <div class="segmented-control__indicator"></div>
                            <div class="segmented-control__item segmented-control__item--active">Label <span
                                    class="segmented-control__number">1</span></div>
                            <div class="segmented-control__item">Label <span class="segmented-control__number">2</span>
                            </div>
                            <div class="segmented-control__item">Label</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const state = {
            size: 'segmented-control--medium',
            bg: 'bg-surface',
            items: [
                { label: 'Label 1', number: '12' },
                { label: 'Label 2', number: '5' },
                { label: 'Label 3', number: '' }
            ],
            activeIndex: 0
        };

        let playgroundControl = null;

        function updateIndicator(control, activeItem, instant = false) {
            const indicator = control.querySelector('.segmented-control__indicator');
            if (!indicator || !activeItem) return;

            if (instant) {
                indicator.style.transition = 'none';
            } else {
                indicator.style.transition = 'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)';
            }

            indicator.style.width = `${activeItem.offsetWidth}px`;
            indicator.style.transform = `translateX(${activeItem.offsetLeft - 2}px)`; // 2px is padding

            if (instant) {
                // Force layout and restore transition
                indicator.offsetHeight;
                setTimeout(() => {
                    indicator.style.transition = '';
                }, 50);
            }
        }

        function renderPlayground(recreate = false) {
            const previewArea = document.getElementById('playground-preview');
            previewArea.className = `preview-area ${state.bg}`;

            const container = document.getElementById('playground-target');

            // Recreate DOM if structure changes (count or size)
            if (recreate || !playgroundControl) {
                container.innerHTML = '';
                playgroundControl = document.createElement('div');
                playgroundControl.className = `segmented-control ${state.size}`;

                const indicator = document.createElement('div');
                indicator.className = 'segmented-control__indicator';
                playgroundControl.appendChild(indicator);

                state.items.forEach((itemData, index) => {
                    const item = document.createElement('div');
                    item.className = 'segmented-control__item';

                    const labelSpan = document.createElement('span');
                    labelSpan.className = 'item-label-text';
                    item.appendChild(labelSpan);

                    const numSpan = document.createElement('span');
                    numSpan.className = 'segmented-control__number';
                    item.appendChild(numSpan);

                    item.onclick = () => {
                        state.activeIndex = index;
                        updatePlaygroundActiveState();
                    };
                    playgroundControl.appendChild(item);
                });
                container.appendChild(playgroundControl);
            }

            // Update content without recreating nodes
            const items = playgroundControl.querySelectorAll('.segmented-control__item');
            state.items.forEach((itemData, index) => {
                const item = items[index];
                item.querySelector('.item-label-text').textContent = itemData.label || 'Label';
                const numSpan = item.querySelector('.segmented-control__number');
                numSpan.textContent = itemData.number;
                numSpan.style.display = itemData.number ? 'inline' : 'none';
            });

            // Recreateì¸ ê²½ìš° ì¦‰ì‹œ ë°°ì¹˜(instant), í´ë¦­ì¸ ê²½ìš° ì• ë‹ˆë©”ì´ì…˜(smooth)
            updatePlaygroundActiveState(recreate);
            updateCode();
            renderLabelInputs();
        }

        function updatePlaygroundActiveState(instant = false) {
            if (!playgroundControl) return;
            const items = playgroundControl.querySelectorAll('.segmented-control__item');
            let activeElement = null;

            items.forEach((item, index) => {
                if (index === state.activeIndex) {
                    item.classList.add('segmented-control__item--active');
                    activeElement = item;
                } else {
                    item.classList.remove('segmented-control__item--active');
                }
            });

            if (activeElement) {
                // Use requestAnimationFrame to ensure offsetWidth/offsetLeft are ready
                requestAnimationFrame(() => {
                    updateIndicator(playgroundControl, activeElement, instant);
                });
            }
        }

        function initGalleryAnimations() {
            const syncGallery = (id) => {
                const control = document.getElementById(id);
                const items = control.querySelectorAll('.segmented-control__item');
                const indicator = control.querySelector('.segmented-control__indicator');

                const update = (target) => {
                    indicator.style.width = `${target.offsetWidth}px`;
                    indicator.style.transform = `translateX(${target.offsetLeft - 2}px)`;
                };

                items.forEach((item, idx) => {
                    if (item.classList.contains('segmented-control__item--active')) {
                        update(item);
                    }
                    item.onclick = () => {
                        items.forEach(i => i.classList.remove('segmented-control__item--active'));
                        item.classList.add('segmented-control__item--active');
                        update(item);
                    };
                });
            };

            syncGallery('gallery-sc-medium');
            syncGallery('gallery-sc-small');
        }

        function renderLabelInputs() {
            const container = document.getElementById('label-inputs');
            if (container.children.length === state.items.length) {
                state.items.forEach((item, index) => {
                    const row = container.children[index];
                    row.querySelector('.label-input').value = item.label;
                    row.querySelector('.number-input').value = item.number;
                });
            } else {
                container.innerHTML = '';
                state.items.forEach((item, index) => {
                    const row = document.createElement('div');
                    row.className = 'label-input-row';

                    const labelInput = document.createElement('input');
                    labelInput.className = 'label-input';
                    labelInput.value = item.label;
                    labelInput.placeholder = `Label ${index + 1}`;
                    labelInput.oninput = (e) => {
                        state.items[index].label = e.target.value;
                        renderPlayground(); // Content only update
                    };

                    const numInput = document.createElement('input');
                    numInput.className = 'number-input';
                    numInput.value = item.number;
                    numInput.placeholder = `No.`;
                    numInput.oninput = (e) => {
                        state.items[index].number = e.target.value;
                        renderPlayground(); // Content only update
                    };

                    row.appendChild(labelInput);
                    row.appendChild(numInput);
                    container.appendChild(row);
                });
            }
            document.getElementById('current-count').textContent = state.items.length;
        }

        function updateCode() {
            const itemsHtml = state.items.map((item, index) => {
                const activeClass = index === state.activeIndex ? ' segmented-control__item--active' : '';
                const numberHtml = item.number ? ` <span class="segmented-control__number">${item.number}</span>` : '';
                return `    <div class="segmented-control__item${activeClass}">${item.label || 'Label'}${numberHtml}</div>`;
            }).join('\n');
            const code = `<div class="segmented-control ${state.size}">\n    <div class="segmented-control__indicator"></div>\n${itemsHtml}\n</div>`;
            document.getElementById('generated-code').textContent = code;
        }

        // ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë°”ì¸ë”©
        document.querySelectorAll('#size-toggles .toggle-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('#size-toggles .toggle-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.size = btn.dataset.value;
                renderPlayground(true); // Structure change, recreate
            };
        });

        document.querySelectorAll('#bg-toggles .toggle-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('#bg-toggles .toggle-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.bg = btn.dataset.value;
                renderPlayground(); // BG only change
            };
        });

        document.getElementById('increase-items').onclick = () => {
            if (state.items.length < 6) {
                state.items.push({ label: `Label ${state.items.length + 1}`, number: '' });
                renderPlayground(true); // Count change, recreate
            }
        };

        document.getElementById('decrease-items').onclick = () => {
            if (state.items.length > 2) {
                state.items.pop();
                if (state.activeIndex >= state.items.length) state.activeIndex = state.items.length - 1;
                renderPlayground(true); // Count change, recreate
            }
        };

        document.getElementById('copy-code').onclick = () => {
            const code = document.getElementById('generated-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.getElementById('copy-code');
                const originalText = btn.textContent;
                btn.textContent = 'âœ…';
                setTimeout(() => btn.textContent = originalText, 2000);
            });
        };

        // í…Œë§ˆ í† ê¸€
        document.getElementById('theme-toggle').onclick = () => {
            const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            setTimeout(() => {
                updatePlaygroundActiveState();
                initGalleryAnimations();
            }, 100); // Wait for CSS vars to apply
        };

        renderPlayground();
        initGalleryAnimations();

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘
        window.onresize = () => {
            updatePlaygroundActiveState();
            initGalleryAnimations();
        };
    </script>
</body>

</html>